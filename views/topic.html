<link rel="stylesheet" href="public/js/timelinejs/compiled/css/timeline.css" />

<script src="/socket.io/lib/socket.io.js"></script>
<script src="//code.jquery.com/jquery-1.10.2.min.js"></script>

<div id="my-timeline" href="{{timeline}}" style='background-image: url("{{cover}}")'></div>

<div id='hs'>
	<span id='desc-container'>
		<div id='desc-meta'>
			<h2 id='desc-tagline'> {{subtitle}} </h2>
			<p id='desc-author'> {{author}} </p>
			<p id='desc-date'> {{date}} </p>
		</div>
		
		<p id='desc'> {{description}}</p>
	</span>
</div>

<div id='hs'>
	<h2 class='sec-title'>IMAGES</h2>

	<div id='images'>
	{{#images}}
		<img id='img' src = '{{.}}'>
	{{/images}}
 	<img id='img' src='{{cover}}'>

 	</div>
</div>


<div id='hs'>

	<h2 class='sec-title'>CHATTER</h2>
	<ul id="tweets">
		
		<li class='tweet'>

		</li>

	</ul>

</div>

<!-- <div id='footer' style='background-image: url("{{cover}}")'></div>
 -->
<a href="/">Back</a>

<script src='public/js/blur.js'></script>
<script src='public/js/timelinejs/compiled/js/storyjs-embed.js'></script>

<script>
	function replaceURLWithHTMLLinks(text) {
    	var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;
    	return text.replace(exp,"<a href='$1'>$1</a>"); 
	}

	var socket = io.connect();
	var MAX = 30;
	var num = 0;
	 socket.on('message', function (data) {
	 	num += 1
	 	var text = "<li class='tweet' > <img id='twt-avatar' src='"+data.user_image+"'> <strong><a href='http://twitter.com/"+data.user +"'>@" + data.user+ "</a></strong>: " + 
	 		replaceURLWithHTMLLinks(data.text)+ "</li>"
	 		console.log(text)
	 	$("#tweets").prepend(text)
	 	if (num > MAX) {
	 	  $("#tweets li:last").remove()
	 	}
	 });

	 socket.emit('subscribe', "{{topic}}");

	 console.log("topic data:")
	 var topic_data = {{{topic_data}}}
	 var timeline = topic_data.timeline
	 var images = topic_data.images
	 var title = topic_data.title
	 var subtitle = topic_data.subtitle
	 var description = topic_data.description
	 var cover = topic_data.cover
	 var author = topic_data.author;


	/* Display main timeline using TimelineJS
	 * in #my-timeline div
	 */
	$('#my-timeline').blurjs({
			source: '#my-timeline',
			radius: 5,
			overlay: 'rgba(40,45,50,0.7)'
	});
	$('#footer').blurjs({
			source: '#footer',
			radius: 5,
			overlay: 'rgba(40,45,50,0.7)'
	});

	createStoryJS({
		type:       'timeline',
		width:      '100%',
		height:     '550',
		source:     topic_data.timeline,
		embed_id:   'my-timeline',
		stylesheet : 'timeline.css'
	});


	/* Display description */

	/* Display gallery of images */

	/* Display tweets */

</script>

